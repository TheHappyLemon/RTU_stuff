import json
import ics
import datetime

# to insert this into phone
# goto ortus -> grafiki -> f12 -> network getcalendarreventdataurl...
# vstavlyaeshh zapros v novij tab i kopriuesh teksts syda
# tok vnachale uberi vse \n cherez notepad++: edit - line operations - join lines

def main():
    file = '''[{"id":323759,"title":"","start":"2023-04-11T08:15:00","end":"2023-04-11T09:50:00","description":"","extendedProps":{"longTitle":"Lekc. Inovatīvu produktu izstrāde un uzņēmējdarbība, Dekāna vietnieks A.Ozols (Zun. 8-302*) ","shortTitle":"Lekc. Inovatīvu produktu izstrāde un uzņēmējdarbība, Dekāna vietnieks A.Ozols (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":219411,"title":"","start":"2023-04-11T10:15:00","end":"2023-04-11T11:50:00","description":"","extendedProps":{"longTitle":"Lekc. Ievads operāciju pētīšanā, Docents V.Minkēviča (Zun. 8-302*) ","shortTitle":"Lekc. Ievads operāciju pētīšanā, Docents V.Minkēviča (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":282363,"title":"","start":"2023-04-11T12:30:00","end":"2023-04-11T14:05:00","description":"","extendedProps":{"longTitle":"Lekc. Datu bāzu vadības sistēmas, Docents J.Eiduks, Pētnieks M.Pudāne (Zun. 8-302*) ","shortTitle":"Lekc. Datu bāzu vadības sistēmas, Docents J.Eiduks, Pētnieks M.Pudāne (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":219431,"title":"","start":"2023-04-11T14:30:00","end":"2023-04-11T16:05:00","description":"","extendedProps":{"longTitle":"Lekc. Objektorientētā programmēšana, Studiju prorektors U.Sukovskis (Zun. 8-302*) ","shortTitle":"Lekc. Objektorientētā programmēšana, Studiju prorektors U.Sukovskis (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":228420,"title":"","start":"2023-04-12T08:15:00","end":"2023-04-12T09:50:00","description":"","extendedProps":{"longTitle":"Pr.d. Gadījuma procesi, Profesors A.Matvejevs (Āze. 12-101*) ","shortTitle":"Pr.d. Gadījuma procesi, Profesors A.Matvejevs (Āze. 12-101*)"},"url":"","className":"eventStatus1"},{"id":289268,"title":"","start":"2023-04-12T10:15:00","end":"2023-04-12T11:50:00","description":"","extendedProps":{"longTitle":"Lekc. Mākslīgā intelekta pamati, Asociētais profesors A.Anohina-Naumeca (Zun. 8-302*) ","shortTitle":"Lekc. Mākslīgā intelekta pamati, Asociētais profesors A.Anohina-Naumeca (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":289284,"title":"","start":"2023-04-12T12:30:00","end":"2023-04-12T14:05:00","description":"","extendedProps":{"longTitle":"Lekc. Mākslīgā intelekta pamati, Asociētais profesors A.Anohina-Naumeca (Zun. 8-302*) ","shortTitle":"Lekc. Mākslīgā intelekta pamati, Asociētais profesors A.Anohina-Naumeca (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":228911,"title":"","start":"2023-04-13T12:30:00","end":"2023-04-13T14:05:00","description":"","extendedProps":{"longTitle":"Pr.d. Inovatīvu produktu izstrāde un uzņēmējdarbība, Vecākais laborants U.Blathens, Dekāna vietnieks A.Ozols (Zun. 8-108*) ","shortTitle":"Pr.d. Inovatīvu produktu izstrāde un uzņēmējdarbība, Vecākais laborants U.Blathens, Dekāna vietnieks A.Ozols (Zun. 8-108*)"},"url":"","className":"eventStatus1"},{"id":363158,"title":"","start":"2023-04-13T14:30:00","end":"2023-04-13T16:05:00","description":"","extendedProps":{"longTitle":"Lab.d. Datu bāzu vadības sistēmas, Lektors A.Auziņš (Zun. 10-121*) ","shortTitle":"Lab.d. Datu bāzu vadības sistēmas, Lektors A.Auziņš (Zun. 10-121*)"},"url":"","className":"eventStatus1"},{"id":227600,"title":"","start":"2023-04-17T14:30:00","end":"2023-04-17T16:05:00","description":"","extendedProps":{"longTitle":"Pr.d. Ievads operāciju pētīšanā, Docents V.Minkēviča (Att. --*) ","shortTitle":"Pr.d. Ievads operāciju pētīšanā, Docents V.Minkēviča (Att. --*)"},"url":"","className":"eventStatus1"},{"id":220030,"title":"","start":"2023-04-17T16:30:00","end":"2023-04-17T18:05:00","description":"","extendedProps":{"longTitle":"Lekc. Datu vizualizācijas pamati, Docents V.Šakele (Att. --*) ","shortTitle":"Lekc. Datu vizualizācijas pamati, Docents V.Šakele (Att. --*)"},"url":"","className":"eventStatus1"},{"id":323760,"title":"","start":"2023-04-18T08:15:00","end":"2023-04-18T09:50:00","description":"","extendedProps":{"longTitle":"Lekc. Inovatīvu produktu izstrāde un uzņēmējdarbība, Dekāna vietnieks A.Ozols (Zun. 8-302*) ","shortTitle":"Lekc. Inovatīvu produktu izstrāde un uzņēmējdarbība, Dekāna vietnieks A.Ozols (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":219412,"title":"","start":"2023-04-18T10:15:00","end":"2023-04-18T11:50:00","description":"","extendedProps":{"longTitle":"Lekc. Ievads operāciju pētīšanā, Docents V.Minkēviča (Zun. 8-302*) ","shortTitle":"Lekc. Ievads operāciju pētīšanā, Docents V.Minkēviča (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":282364,"title":"","start":"2023-04-18T12:30:00","end":"2023-04-18T14:05:00","description":"","extendedProps":{"longTitle":"Lekc. Datu bāzu vadības sistēmas, Docents J.Eiduks, Pētnieks M.Pudāne (Zun. 8-302*) ","shortTitle":"Lekc. Datu bāzu vadības sistēmas, Docents J.Eiduks, Pētnieks M.Pudāne (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":219432,"title":"","start":"2023-04-18T14:30:00","end":"2023-04-18T16:05:00","description":"","extendedProps":{"longTitle":"Lekc. Objektorientētā programmēšana, Studiju prorektors U.Sukovskis (Zun. 8-302*) ","shortTitle":"Lekc. Objektorientētā programmēšana, Studiju prorektors U.Sukovskis (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":229169,"title":"","start":"2023-04-19T08:15:00","end":"2023-04-19T09:50:00","description":"","extendedProps":{"longTitle":"Lab.d. Objektorientētā programmēšana, Asociētais profesors P.Rusakovs (Zun. 10-330*) ","shortTitle":"Lab.d. Objektorientētā programmēšana, Asociētais profesors P.Rusakovs (Zun. 10-330*)"},"url":"","className":"eventStatus1"},{"id":268659,"title":"","start":"2023-04-19T10:15:00","end":"2023-04-19T11:50:00","description":"","extendedProps":{"longTitle":"Lekc. Gadījuma procesi, Profesors A.Matvejevs, Profesors K.Šadurskis (Zun. 8-302*) ","shortTitle":"Lekc. Gadījuma procesi, Profesors A.Matvejevs, Profesors K.Šadurskis (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":289285,"title":"","start":"2023-04-19T12:30:00","end":"2023-04-19T14:05:00","description":"","extendedProps":{"longTitle":"Lekc. Mākslīgā intelekta pamati, Asociētais profesors A.Anohina-Naumeca (Zun. 8-302*) ","shortTitle":"Lekc. Mākslīgā intelekta pamati, Asociētais profesors A.Anohina-Naumeca (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":228912,"title":"","start":"2023-04-20T12:30:00","end":"2023-04-20T14:05:00","description":"","extendedProps":{"longTitle":"Pr.d. Inovatīvu produktu izstrāde un uzņēmējdarbība, Vecākais laborants U.Blathens, Dekāna vietnieks A.Ozols (Zun. 8-108*) ","shortTitle":"Pr.d. Inovatīvu produktu izstrāde un uzņēmējdarbība, Vecākais laborants U.Blathens, Dekāna vietnieks A.Ozols (Zun. 8-108*)"},"url":"","className":"eventStatus1"},{"id":363159,"title":"","start":"2023-04-20T14:30:00","end":"2023-04-20T16:05:00","description":"","extendedProps":{"longTitle":"Lab.d. Datu bāzu vadības sistēmas, Lektors A.Auziņš (Zun. 10-121*) ","shortTitle":"Lab.d. Datu bāzu vadības sistēmas, Lektors A.Auziņš (Zun. 10-121*)"},"url":"","className":"eventStatus1"},{"id":220031,"title":"","start":"2023-04-24T16:30:00","end":"2023-04-24T18:05:00","description":"","extendedProps":{"longTitle":"Lekc. Datu vizualizācijas pamati, Docents V.Šakele (Att. --*) ","shortTitle":"Lekc. Datu vizualizācijas pamati, Docents V.Šakele (Att. --*)"},"url":"","className":"eventStatus1"},{"id":323761,"title":"","start":"2023-04-25T08:15:00","end":"2023-04-25T09:50:00","description":"","extendedProps":{"longTitle":"Lekc. Inovatīvu produktu izstrāde un uzņēmējdarbība, Dekāna vietnieks A.Ozols (Zun. 8-302*) ","shortTitle":"Lekc. Inovatīvu produktu izstrāde un uzņēmējdarbība, Dekāna vietnieks A.Ozols (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":219413,"title":"","start":"2023-04-25T10:15:00","end":"2023-04-25T11:50:00","description":"","extendedProps":{"longTitle":"Lekc. Ievads operāciju pētīšanā, Docents V.Minkēviča (Zun. 8-302*) ","shortTitle":"Lekc. Ievads operāciju pētīšanā, Docents V.Minkēviča (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":282365,"title":"","start":"2023-04-25T12:30:00","end":"2023-04-25T14:05:00","description":"","extendedProps":{"longTitle":"Lekc. Datu bāzu vadības sistēmas, Docents J.Eiduks, Pētnieks M.Pudāne (Zun. 8-302*) ","shortTitle":"Lekc. Datu bāzu vadības sistēmas, Docents J.Eiduks, Pētnieks M.Pudāne (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":219433,"title":"","start":"2023-04-25T14:30:00","end":"2023-04-25T16:05:00","description":"","extendedProps":{"longTitle":"Lekc. Objektorientētā programmēšana, Studiju prorektors U.Sukovskis (Zun. 8-302*) ","shortTitle":"Lekc. Objektorientētā programmēšana, Studiju prorektors U.Sukovskis (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":228421,"title":"","start":"2023-04-26T08:15:00","end":"2023-04-26T09:50:00","description":"","extendedProps":{"longTitle":"Pr.d. Gadījuma procesi, Profesors A.Matvejevs (Āze. 12-101*) ","shortTitle":"Pr.d. Gadījuma procesi, Profesors A.Matvejevs (Āze. 12-101*)"},"url":"","className":"eventStatus1"},{"id":289269,"title":"","start":"2023-04-26T10:15:00","end":"2023-04-26T11:50:00","description":"","extendedProps":{"longTitle":"Lekc. Mākslīgā intelekta pamati, Asociētais profesors A.Anohina-Naumeca (Zun. 8-302*) ","shortTitle":"Lekc. Mākslīgā intelekta pamati, Asociētais profesors A.Anohina-Naumeca (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":289286,"title":"","start":"2023-04-26T12:30:00","end":"2023-04-26T14:05:00","description":"","extendedProps":{"longTitle":"Lekc. Mākslīgā intelekta pamati, Asociētais profesors A.Anohina-Naumeca (Zun. 8-302*) ","shortTitle":"Lekc. Mākslīgā intelekta pamati, Asociētais profesors A.Anohina-Naumeca (Zun. 8-302*)"},"url":"","className":"eventStatus1"},{"id":228913,"title":"","start":"2023-04-27T12:30:00","end":"2023-04-27T14:05:00","description":"","extendedProps":{"longTitle":"Pr.d. Inovatīvu produktu izstrāde un uzņēmējdarbība, Vecākais laborants U.Blathens, Dekāna vietnieks A.Ozols (Zun. 8-108*) ","shortTitle":"Pr.d. Inovatīvu produktu izstrāde un uzņēmējdarbība, Vecākais laborants U.Blathens, Dekāna vietnieks A.Ozols (Zun. 8-108*)"},"url":"","className":"eventStatus1"},{"id":363160,"title":"","start":"2023-04-27T14:30:00","end":"2023-04-27T16:05:00","description":"","extendedProps":{"longTitle":"Lab.d. Datu bāzu vadības sistēmas, Lektors A.Auziņš (Zun. 10-121*) ","shortTitle":"Lab.d. Datu bāzu vadības sistēmas, Lektors A.Auziņš (Zun. 10-121*)"},"url":"","className":"eventStatus1"}]'''
    data = json.loads(file, strict=False)
    c = ics.Calendar()
    zone_info = datetime.datetime.now().astimezone().tzinfo
    daylight = zone_info.tzname(datetime.datetime.now())
    # +02:00 - zimnee vremya +03:00 - letnee vremya
    if daylight == "FLE Daylight Time":
        offset = '+03:00'
    elif daylight == "FLE Standard Time":
        offset = '+02:00'
    else:
        print("unknown daylight", daylight)
    for s in data:
        # POCHEMU?! RTU menyaet polya
        #name  = s['title'][:s['title'].index(','):]
        #name  = name[name.rfind('.') + 2::]
        #descr = s['title'][:s['title'].index('(')]
        #locat = s['title'][s['title'].index('(') + 1:s['title'].index('*)')]
        props = s['extendedProps']
        name = props['longTitle'][:props['longTitle'].index(','):].strip()
        descr =  props['longTitle'][props['longTitle'].index(',') + 1:props['longTitle'].index('('):].strip()
        locat = props['longTitle'][props['longTitle'].index('(') + 1:props['longTitle'].index('*)'):].strip()
        start = s['start'] + offset
        end   = s['end']   + offset
        e = ics.Event(name=name, description=descr, location=locat, begin=start, end=end)
        c.events.add(e)
    with open(file='my.ics', mode='w+', encoding="utf-8") as my_file:
        my_file.writelines(c.serialize_iter())


if __name__ == "__main__":
    main()
